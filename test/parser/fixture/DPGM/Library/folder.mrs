Dim MDMDoc
Dim oDictionary
Dim oFolder, strFolderName, strDictionaryItemName
dim oRoutingItem, oField, oRoutingLevel,renme,fielder
dim strFieldName,strExpression
set oDictionary=CreateObject("Scripting.Dictionary")
set oRoutingLevel=Tabledoc.DataSet.Variables                      'Start with the "top" level of routing
for each fielder in docMDM.fields
	Set oField = MDMDoc.Fields[fielder.name] 'Find the field in the metadata
	strDictionaryItemName=""                                          'Initialise the name we are going to use with the dictionary
	if oField.properties.item["folder"]=false then
		if oField.issystem=true then 'If we have at least one level of folders to build...
		        ofield.properties.item["folder"]="System"
        	else
                      	if ofield.properties.item["shell"]=true then
        			ofield.properties.item["folder"]="Shell"
                       	else
                                ofield.properties.item["folder"]="Questionnaire"
	                end if
                end if
        end if
	strfoldername=oField.properties.item["folder"]
        outf[6]=ofield
        Set oRoutingItem = oRoutingLevel.FindItem(strFolderName) 'Look for the folder at the current routing level
        If oRoutingItem.IsNullObject() Then 'If we can't find it we need to make it
        	Set oFolder = Tabledoc.DataSet.Variables.AddNewFolder(strFolderName) 'Create the folder
                strDictionaryItemName=strFolderName 'The full path is included in the dictionary name to ensure it is unique
                oDictionary.Add(strDictionaryItemName,oFolder) 'Add the folder to our dictionary
        else
                strDictionaryItemName=strFolderName 'The full path is included in the dictionary name to ensure it is unique
                set oFolder=oDictionary.Item[strDictionaryItemName] 'Folder already exists so retrieve it from the dictionary
        end if
        oFolder.Add(oField)'Add the field to the folder
        Tabledoc.DataSet.Variables.Remove(oField.name)
next 'Next row




