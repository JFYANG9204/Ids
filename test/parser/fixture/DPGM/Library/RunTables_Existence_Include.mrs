'*****FILE VERSION=1, DATE LAST MODIFIED=2012/08/29, KO

'Included into the RunTables.mrs file

Dim t,sLeftSpec,arrVarNotes,sLeftNote,i
Dim blnMatch, arrSpecs, sSpecs, j

for each t in tabledoc.Tables
      if left(t.Specification,9) <> "profile({" then
        if find(t.Specification,"[..].")< 0 then 
                if left(t.Specification,6) <> "axis({" then
            t.Annotations[4].Specification = MDM.Variables[t.axes.side.subaxes[0].name].Properties.Item["CategoryExistenceLabel"][CONTEXT]
            sLeftSpec = left(t.Specification,find(t.Specification,"*"))
            arrVarNotes = split(MDM.Variables[t.axes.side.subaxes[0].name].Properties.Item["VariableExistenceLabel"][CONTEXT],";")

            'remove syntax characters from spec to leave only variable and iteration names
            sSpecs = Replace(sLeftSpec," ","")
            sSpecs = Replace(sSpecs,"+",".")
            sSpecs = Replace(sSpecs,">",".")
            sSpecs = Replace(sSpecs,"[",".")
            sSpecs = Replace(sSpecs,"]","")
            sSpecs = Replace(sSpecs,"{","")
            sSpecs = Replace(sSpecs,"}","")
            
            arrSpecs = split(sSpecs,".")
            
            for i = 0 to ubound(arrVarNotes)
                  sLeftNote = trim(left(arrVarNotes[i],find(arrVarNotes[i]," - ")))
                  if find(ucase(sLeftSpec),ucase(sLeftNote))<> -1 then
                        '**************
                              'make sure it is an exact match - don't want to confuse pepsi with dietpepsi, q4 with q4a, etc.
                              'figure out if dealing with a field or category/iteration
                              blnMatch = False
                              

                              for j = 0 to ubound(arrSpecs)
                                    if trim(ucase(sLeftNote)) = trim(ucase(arrSpecs[j])) then
                                          blnMatch = True
                                          exit for
                                    end if
                              next
                              if blnMatch = True then
                                    'matched it in both directions
                              
                                    '************
                                    'choose one of these options for placement of the variable level notes
                                    if iVariableExistenceLabel = 0 then
                                          if i=0 then
                                                t.Annotations[1].Specification = t.Annotations[1].Specification + "/"
                                          end if
                                          'put it in annotation position 1 - will appear as part of the base title
                                          t.Annotations[1].Specification = t.Annotations[1].Specification + mid(arrVarNotes[i],find(arrVarNotes[i]," - ") + 3) + "; "
                        
                                    elseif iVariableExistenceLabel = 1 then
                                          'put it in annotation position 4 - will appear as a footnote
                                          t.Annotations[4].Specification = t.Annotations[4].Specification + mid(arrVarNotes[i],find(arrVarNotes[i]," - ") + 3) + "; "
                                    end if
                              end if
                        end if
                        
            next  
            if iVariableExistenceLabel = 0 and right(t.Annotations[1].Specification,2) = "; " then
                  t.Annotations[1].Specification = left(t.Annotations[1].Specification,len(t.Annotations[1].Specification) - 2)
            end if
            if iVariableExistenceLabel = 1 and right(t.Annotations[4].Specification,2) = "; " then
                  t.Annotations[4].Specification = left(t.Annotations[4].Specification,len(t.Annotations[4].Specification) -2)
            end if
        end if
      end if
    end if
next

